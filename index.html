<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Vault</title>
  <meta name="theme-color" content="#0f172a" />
  <link rel="manifest" href="./manifest.webmanifest" />
  <style>
    :root{--bg:#0f172a;--panel:#0b1220;--line:#1f2937;--text:#e5e7eb;--muted:#94a3b8;--accent:#22d3ee}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Ubuntu,Arial}
    .app{display:grid;grid-template-columns:280px 1fr;min-height:100vh}
    aside{background:var(--panel);border-right:1px solid var(--line);padding:10px}
    header{display:flex;align-items:center;justify-content:space-between;gap:8px}
    h1{font-size:16px;margin:0}
    .btn{cursor:pointer;border:1px solid var(--line);background:#0a0f1d;color:#e5e7eb;padding:6px 10px;border-radius:10px}
    .btn.primary{background:var(--accent);color:#05121a;border:none}
    .btn.danger{background:#7f1d1d;border-color:#7f1d1d}
    .stack{display:flex;gap:8px;flex-wrap:wrap}
    .search{width:100%;margin:8px 0}
    input,select,textarea{background:#060b16;border:1px solid var(--line);color:#e5e7eb;border-radius:10px;padding:8px}
    .tree{max-height:calc(100vh - 180px);overflow:auto}
    .folder,.file{padding:6px 8px;border-radius:8px;margin:2px 0;display:flex;justify-content:space-between;gap:8px}
    .folder:hover,.file:hover{background:#0f172a}
    .muted{color:#94a3b8}
    main{padding:14px}
    .topbar{display:flex;justify-content:space-between;align-items:center}
    .crumbs{font-size:12px;color:#94a3b8}
    .row{display:flex;gap:10px;align-items:center}
    .editor{display:grid;grid-template-rows:auto 1fr auto;gap:8px;height:calc(100vh - 120px)}
    .editor textarea{width:100%;height:100%;resize:none;font-family:ui-monospace,Consolas,monospace;line-height:1.35;border-radius:12px}
    .panel{background:#0b1220;border:1px solid #1f2937;border-radius:12px;padding:8px}
    #preview{min-height:120px;overflow:auto;background:#06111a}
    .pill{font-size:12px;background:#22d3ee;color:#05121a;border-radius:999px;padding:2px 8px}
    .tag{font-size:11px;color:#94a3b8}
    .hidden{display:none !important}
    .modal{position:fixed;inset:0;background:#0009;display:flex;align-items:center;justify-content:center}
    .card{width:min(420px,92vw);background:#0b1220;border:1px solid #1f2937;border-radius:14px;padding:16px}
    .card h3{margin:0 0 10px 0}
  </style>
</head>
<body>
  <div class="app">
    <aside>
      <header>
        <h1>My Vault</h1>
        <div class="row">
          <button id="installBtn" class="btn" hidden>Install</button>
          <button id="loginBtn" class="btn">Login</button>
          <button id="logoutBtn" class="btn hidden">Logout</button>
        </div>
      </header>
      <input id="search" class="search" placeholder="Search folders/filesâ€¦" />
      <div class="stack">
        <button id="newFolder" class="btn adminOnly hidden">+ Folder</button>
        <button id="newFile" class="btn adminOnly hidden">+ File</button>
        <input id="importFile" type="file" class="btn adminOnly hidden" title="Import file" />
        <button id="exportAll" class="btn">Export JSON</button>
        <button id="importJson" class="btn adminOnly hidden">Import JSON</button>
      </div>
      <div id="tree" class="tree"></div>
    </aside>
    <main>
      <div class="topbar">
        <div>
          <div id="crumbs" class="crumbs">Home</div>
          <h2 id="fileTitle">No file selected</h2>
          <span id="roleTag" class="tag">Guest mode</span>
        </div>
        <div class="row">
          <span id="langBadge" class="pill hidden"></span>
          <button id="copyBtn" class="btn">Copy</button>
          <button id="saveBtn" class="btn primary adminOnly hidden">Save</button>
          <button id="deleteBtn" class="btn danger adminOnly hidden">Delete</button>
          <button id="openRaw" class="btn">Open</button>
        </div>
      </div>

      <div class="editor">
        <textarea id="editor" class="panel" placeholder="Select a file or create one (admin)."></textarea>
        <div id="preview" class="panel"></div>
        <div id="status" class="panel"></div>
      </div>
    </main>
  </div>

  <!-- Auth Modal -->
  <div id="authModal" class="modal hidden">
    <div class="card">
      <h3 id="authTitle">Admin setup</h3>
      <p id="authText" class="muted"></p>
      <div id="setupBox">
        <input id="newPass" type="password" placeholder="Create admin password" style="width:100%;margin:6px 0" />
        <input id="newPass2" type="password" placeholder="Confirm password" style="width:100%;margin:6px 0" />
        <button id="setupBtn" class="btn primary" style="width:100%">Set password</button>
      </div>
      <div id="loginBox" class="hidden">
        <input id="loginPass" type="password" placeholder="Enter admin password" style="width:100%;margin:6px 0" />
        <button id="loginDo" class="btn primary" style="width:100%">Login</button>
      </div>
    </div>
  </div>

  <script src="./db.js"></script>
  <script src="./auth.js"></script>
  <script src="./app.js"></script>
</body>
</html>