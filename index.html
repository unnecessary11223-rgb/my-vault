<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Vault</title>
  <meta name="theme-color" content="#0f172a" />
  <link rel="manifest" href="./manifest.webmanifest" />
  <style>
    :root{--bg:#0f172a;--panel:#0b1220;--line:#1f2937;--text:#e5e7eb;--muted:#94a3b8;--accent:#22d3ee;--bad:#7f1d1d;--good:#16a34a}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Ubuntu,Arial}
    .app{display:grid;grid-template-columns:280px 1fr;min-height:100vh;transition:grid-template-columns .2s ease}
    .app.collapsed{grid-template-columns:0 1fr}
    aside{background:var(--panel);border-right:1px solid var(--line);padding:10px;overflow:hidden}
    header{display:flex;align-items:center;justify-content:space-between;gap:8px}
    h1{font-size:16px;margin:0}
    .btn{cursor:pointer;border:1px solid var(--line);background:#0a0f1d;color:var(--text);padding:6px 10px;border-radius:10px}
    .btn.primary{background:var(--accent);color:#05121a;border:none}
    .btn.danger{background:var(--bad);border-color:var(--bad)}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .stack{display:flex;gap:8px;flex-wrap:wrap}
    .search{width:100%;margin:8px 0}
    input,textarea{background:#060b16;border:1px solid var(--line);color:var(--text);border-radius:10px;padding:8px}
    .tree{max-height:calc(100vh - 200px);overflow:auto}
    .folder,.file{padding:6px 8px;border-radius:8px;margin:2px 0;display:flex;justify-content:space-between;gap:8px}
    .folder:hover,.file:hover{background:#0f172a}
    .muted{color:var(--muted)}
    main{padding:14px}
    .topbar{display:flex;justify-content:space-between;align-items:center}
    .role{font-weight:700;padding:4px 10px;border-radius:999px}
    .role.guest{background:#1e293b;color:#e5e7eb;border:1px solid #334155}
    .role.admin{background:var(--good);color:#04120a}
    .crumbs{font-size:12px;color:var(--muted)}
    .workspace{display:grid;grid-template-columns:1fr 1fr;gap:8px;height:calc(100vh - 160px)}
    .panel{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:8px;min-height:140px}
    textarea{width:100%;height:100%;resize:none;font-family:ui-monospace,Consolas,monospace;line-height:1.35}
    #output{white-space:pre-wrap;overflow:auto}
    .hidden{display:none !important}
    .modal{position:fixed;inset:0;background:#0009;display:flex;align-items:center;justify-content:center}
    .card{width:min(420px,92vw);background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:16px}
    .card h3{margin:0 0 10px 0}
    /* Sticky toggle button: always on top and clickable */
    #toggleSidebar {
      position: fixed;
      left: 10px;
      top: 10px;
      z-index: 2147483647;
      pointer-events: auto;
      display: block;
      padding: 8px 10px;
      border-radius: 8px;
      background: var(--accent);
      color: #05121a;
      border: none;
      font-weight: 700;
    }
    /* small hover for close button */
    #authClose:hover { color: var(--accent); }
  </style>
</head>
<body>
  <!-- Sticky toggle button (always visible) -->
  <button id="toggleSidebar" title="Hide/Show sidebar">☰</button>

  <div id="app" class="app">
    <aside>
      <header>
        <h1>My Vault</h1>
        <div class="stack">
          <button id="installBtn" class="btn" hidden>Install</button>
          <button id="loginBtn" class="btn">Login</button>
          <button id="logoutBtn" class="btn hidden">Logout</button>
        </div>
      </header>

      <input id="search" class="search" placeholder="Search by name…" />

      <div class="stack" style="margin-bottom:8px">
        <button id="newFolder" class="btn">+ Folder</button>
        <input id="importFile" type="file" class="btn" title="Import file" />
        <button id="exportAll" class="btn">Export JSON</button>
        <button id="importJson" class="btn">Import JSON</button>
      </div>

      <div id="tree" class="tree"></div>
    </aside>

    <main>
      <div class="topbar">
        <div>
          <div id="crumbs" class="crumbs">Home</div>
          <h2 id="fileTitle">No file selected</h2>
        </div>
        <div class="stack">
          <span id="roleBadge" class="role guest">GUEST</span>
          <button id="copyBtn" class="btn">Copy</button>
          <button id="saveBtn" class="btn primary">Save</button>
          <button id="deleteBtn" class="btn danger">Delete</button>
          <button id="openRaw" class="btn">Open</button>
          <button id="renderBtn" class="btn">Render</button>
          <button id="runCsBtn" class="btn">Run C#</button>
        </div>
      </div>

      <div class="workspace">
        <div class="panel">
          <label>File name:
            <input id="fileName" placeholder="e.g. notes.txt or code.py" style="width:60%;margin-left:8px" />
          </label>
          <textarea id="editor" placeholder="Type or paste your content here…"></textarea>
        </div>
        <div class="panel">
          <strong>Output</strong>
          <pre id="output"></pre>
        </div>
      </div>

      <div id="status" class="panel" style="margin-top:8px"></div>
    </main>
  </div>

  <!-- Auth Modal (with close × button) -->
  <div id="authModal" class="modal hidden">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3 id="authTitle">Admin setup</h3>
        <button id="authClose" title="Close" style="
          background:none;
          border:none;
          color:var(--muted);
          font-size:20px;
          font-weight:bold;
          cursor:pointer;
        ">&times;</button>
      </div>
      <p id="authText" class="muted"></p>

      <div id="setupBox">
        <input id="newPass" type="password" placeholder="Create admin password" style="width:100%;margin:6px 0" />
        <input id="newPass2" type="password" placeholder="Confirm password" style="width:100%;margin:6px 0" />
        <button id="setupBtn" class="btn primary" style="width:100%">Set password</button>
      </div>

      <div id="loginBox" class="hidden">
        <input id="loginPass" type="password" placeholder="Enter admin password" style="width:100%;margin:6px 0" />
        <button id="loginDo" class="btn primary" style="width:100%">Login</button>
      </div>
    </div>
  </div>

  <script src="./db.js"></script>
  <script src="./auth.js"></script>
  <script src="./runner.js"></script>
  <script src="./app.js"></script>
</body>
</html>
